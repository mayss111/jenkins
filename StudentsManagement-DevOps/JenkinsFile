pipeline {
    agent any

    environment {
        REGISTRY = "docker.io"
        IMAGE_NAME = "mayss111/studentsmanagement"
        IMAGE_TAG = "latest"
        DOCKER_CREDENTIALS = 'docker-hub-credentials'
    }

    triggers {
        githubPush() // dÃ©clenche Ã  chaque push
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Clean Workspace') {
            steps {
                echo "ðŸ§¹ Nettoyage du workspace..."
                sh 'git clean -fdx'
            }
        }

        stage('Build Maven') {
            steps {
                echo "ðŸ“¦ Construction du projet Maven..."
                script {
                    try {
                        sh 'mvn clean package -DskipTests'
                    } catch (err) {
                        echo "Maven a Ã©chouÃ©, mais on continue"
                        currentBuild.re
